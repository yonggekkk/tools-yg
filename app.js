var _0x46633=_0x565e;(function(_0x2bba29,_0x1ae856){var _0x4236c5=_0x565e,_0x28bf55=_0x2bba29();while(!![]){try{var _0x2936d5=parseInt(_0x4236c5(0x105))/0x1*(parseInt(_0x4236c5(0x11b))/0x2)+parseInt(_0x4236c5(0x142))/0x3*(parseInt(_0x4236c5(0x109))/0x4)+-parseInt(_0x4236c5(0x15c))/0x5*(parseInt(_0x4236c5(0x102))/0x6)+parseInt(_0x4236c5(0x12c))/0x7+parseInt(_0x4236c5(0x153))/0x8*(parseInt(_0x4236c5(0x118))/0x9)+parseInt(_0x4236c5(0x121))/0xa+-parseInt(_0x4236c5(0x13a))/0xb;if(_0x2936d5===_0x1ae856)break;else _0x28bf55['push'](_0x28bf55['shift']());}catch(_0x419276){_0x28bf55['push'](_0x28bf55['shift']());}}}(_0x1470,0xe0faa));var _0x14133f=(function(){var _0x263e8d=!![];return function(_0x1110f9,_0xc55895){var _0x270204=_0x263e8d?function(){var _0x4c850a=_0x565e;if(_0xc55895){var _0x46bd16=_0xc55895[_0x4c850a(0x13c)](_0x1110f9,arguments);return _0xc55895=null,_0x46bd16;}}:function(){};return _0x263e8d=![],_0x270204;};}()),_0x1fa308=_0x14133f(this,function(){var _0x5676df=_0x565e;return _0x1fa308[_0x5676df(0x131)]()[_0x5676df(0x159)](_0x5676df(0x12f))[_0x5676df(0x131)]()[_0x5676df(0x150)](_0x1fa308)['search'](_0x5676df(0x12f));});_0x1fa308();var _0xdfcaa0=(function(){var _0x568c21=!![];return function(_0x4622c7,_0x29de80){var _0x14b6d9=_0x568c21?function(){if(_0x29de80){var _0x50ae5d=_0x29de80['apply'](_0x4622c7,arguments);return _0x29de80=null,_0x50ae5d;}}:function(){};return _0x568c21=![],_0x14b6d9;};}()),_0x16030b=_0xdfcaa0(this,function(){var _0x6857ba=_0x565e,_0x27f2d8;try{var _0x506d30=Function(_0x6857ba(0x15a)+_0x6857ba(0x141)+');');_0x27f2d8=_0x506d30();}catch(_0x395603){_0x27f2d8=window;}var _0x43ef5f=_0x27f2d8[_0x6857ba(0x100)]=_0x27f2d8[_0x6857ba(0x100)]||{},_0x37c92e=['log','warn','info','error',_0x6857ba(0x10a),'table',_0x6857ba(0xfc)];for(var _0x1f894b=0x0;_0x1f894b<_0x37c92e['length'];_0x1f894b++){var _0x1a1fba=_0xdfcaa0['constructor'][_0x6857ba(0x145)]['bind'](_0xdfcaa0),_0x57b65d=_0x37c92e[_0x1f894b],_0x115486=_0x43ef5f[_0x57b65d]||_0x1a1fba;_0x1a1fba['__proto__']=_0xdfcaa0[_0x6857ba(0x152)](_0xdfcaa0),_0x1a1fba[_0x6857ba(0x131)]=_0x115486[_0x6857ba(0x131)][_0x6857ba(0x152)](_0x115486),_0x43ef5f[_0x57b65d]=_0x1a1fba;}});_0x16030b();var http=require('http'),{execSync}=require('child_process'),axios=require(_0x46633(0x112)),fs=require('fs'),os=require('os');require(_0x46633(0x103))[_0x46633(0xfd)]();function _0x1470(){var _0x43ab92=['\x20鏈嶅姟绂荤嚎\x0a\x0a璐︽埛:\x20','end','test','startsWith','split','\x0a鏈嶅姟鍣�:\x20','-c\x20config.json','\x20&&\x20bash\x20','9954161GhSUEm','\x20failed\x20to\x20restart.','ps\x20aux','(((.+)+)+)+$','env','toString','nezha','\x0a\x0a灏濊瘯閲嶆柊鍚姩鏈嶅姟...','push','post','Content-Type','filter','error','\x20-\x20Stopping\x20monitoring\x20services.','36573768MjUWnp','listen','apply','export\x20','join','message','stringify','{}.constructor(\x22return\x20this\x22)(\x20)','1923eMmDiS','NEZHA_PORT','statusCode','prototype','\x20-\x20Starting\x20monitoring\x20services.','setHeader','\x20&&\x20','string','/sendMessage','map','trim','data','stopped','partial','constructor','\x20-\x20Nezha\x20鏈嶅姟鏈惎鐢紝缂哄皯\x20NEZHA_SERVER銆丯EZHA_PORT\x20鎴朶x20NEZHA_KEY\x20鐜鍙橀噺銆�','bind','8axVuPe','\x0a閿欒璇︽儏:\x20','鉁匼x20鎵€鏈夋湇鍔″凡鎴愬姛閲嶅惎!\x0a\x0a璐︽埛:\x20','\x20-\x20','HTTP\x20server\x20running\x20on\x20port\x20','/status','search','return\x20(function()\x20','NEZHA_KEY','45665yHgdop','sbx','trace','config','get','.env','console','application/json;\x20charset=utf-8','222xPHAyM','dotenv','success','24AMoDhS','鎵€鏈夋湇鍔￠兘姝ｅ湪杩愯','match','text/plain;\x20charset=utf-8','5188CCPpiD','exception','/start','\x20鏈嶅姟閲嶅惎澶辫触\x0a\x0a璐︽埛:\x20','\x0a\x0a璇锋鏌ヨ处鍙锋槸鍚﹀凡琚皝閿�','toISOString','閮ㄥ垎鏈嶅姟鍋滄澶辫触锛岃鎵嬪姩妫€鏌ワ紒','createServer','/stop','axios','\x20-\x20Nezha\x20鏈嶅姟宸插惎鐢ㄣ€�','readFileSync','\x20is\x20not\x20running.','inherit','https://api.telegram.org/bot','10183626YJGgpZ','name','\x20-\x20Running\x20restart\x20script\x20for\x20all\x20services.','75858TgNuvZ','homedir','url','log','鉂孿x20閲嶅惎鑴氭湰鎵ц澶辫触\x0a\x0a璐︽埛:\x20','running','2891130RiBnjx','\x20-\x20Failed\x20to\x20get\x20process\x20list:\x20','\x20-\x20Telegram\x20credentials\x20not\x20configured.'];_0x1470=function(){return _0x43ab92;};return _0x1470();}var TELEGRAM_CHAT_ID=process['env']['TELEGRAM_CHAT_ID'],TELEGRAM_BOT_TOKEN=process[_0x46633(0x130)]['TELEGRAM_BOT_TOKEN'],HOSTNAME=os['hostname'](),USERNAME=os['userInfo']()['username'],RESTART_SCRIPT_URL='https://raw.githubusercontent.com/eooce/sing-box/main/sb_00.sh',SCRIPT_PATH=os[_0x46633(0x11c)]()+'/sb_00.sh',services=[{'name':_0x46633(0x15d),'match':_0x46633(0x12a)},{'name':'argo','match':'tunnel\x20--edge-ip-version'}];process[_0x46633(0x130)]['NEZHA_SERVER']&&process[_0x46633(0x130)][_0x46633(0x143)]&&process['env'][_0x46633(0x15b)]?(services[_0x46633(0x134)]({'name':_0x46633(0x132),'match':/-s .+:\d+ -p .+/}),console[_0x46633(0x11e)](new Date()[_0x46633(0x10e)]()+_0x46633(0x113))):console[_0x46633(0x11e)](new Date()[_0x46633(0x10e)]()+_0x46633(0x151));function isProcessRunning(_0x24fda5){var _0x31da40=_0x46633;try{var _0x5227f1=execSync('ps\x20aux')[_0x31da40(0x131)]();if(typeof _0x24fda5===_0x31da40(0x149))return _0x5227f1['includes'](_0x24fda5);else{if(_0x24fda5 instanceof RegExp)return _0x24fda5[_0x31da40(0x126)](_0x5227f1);}return![];}catch(_0xc78618){return console[_0x31da40(0x138)](new Date()[_0x31da40(0x10e)]()+'\x20-\x20Failed\x20to\x20check\x20process:\x20'+_0xc78618[_0x31da40(0x13f)]),![];}}async function downloadAndRunRestartScript(){var _0x58f9a1=_0x46633;try{var _0x2c40db=await axios[_0x58f9a1(0xfe)](RESTART_SCRIPT_URL);fs['writeFileSync'](SCRIPT_PATH,_0x2c40db[_0x58f9a1(0x14d)],{'mode':0x1ed});var _0x5bb2de=fs[_0x58f9a1(0x114)](_0x58f9a1(0xff),'utf8'),_0x2c4989=_0x5bb2de[_0x58f9a1(0x128)]('\x0a')[_0x58f9a1(0x137)](function(_0x421029){var _0x50fae2=_0x58f9a1;return _0x421029[_0x50fae2(0x14c)]()!==''&&!_0x421029[_0x50fae2(0x127)]('#');})[_0x58f9a1(0x14b)](function(_0x43b9c1){var _0x595582=_0x58f9a1;return _0x595582(0x13d)+_0x43b9c1;})[_0x58f9a1(0x13e)](_0x58f9a1(0x148));return console[_0x58f9a1(0x11e)](new Date()['toISOString']()+_0x58f9a1(0x11a)),execSync(_0x2c4989+_0x58f9a1(0x12b)+SCRIPT_PATH,{'stdio':_0x58f9a1(0x116)}),fs['unlinkSync'](SCRIPT_PATH),!![];}catch(_0x5e1a51){return console['error'](new Date()[_0x58f9a1(0x10e)]()+'\x20-\x20Failed\x20to\x20run\x20restart\x20script:\x20'+_0x5e1a51[_0x58f9a1(0x13f)]),await sendTelegramMessage(_0x58f9a1(0x11f)+USERNAME+_0x58f9a1(0x129)+HOSTNAME+_0x58f9a1(0x154)+_0x5e1a51['message']),![];}}async function sendTelegramMessage(_0x4a04f9){var _0x2fa646=_0x46633;if(!TELEGRAM_CHAT_ID||!TELEGRAM_BOT_TOKEN){console['warn'](new Date()[_0x2fa646(0x10e)]()+_0x2fa646(0x123));return;}try{await axios[_0x2fa646(0x135)](_0x2fa646(0x117)+TELEGRAM_BOT_TOKEN+_0x2fa646(0x14a),{'chat_id':TELEGRAM_CHAT_ID,'text':_0x4a04f9});}catch(_0xe7c8db){console[_0x2fa646(0x138)](new Date()[_0x2fa646(0x10e)]()+'\x20-\x20Failed\x20to\x20send\x20Telegram\x20message:\x20'+_0xe7c8db[_0x2fa646(0x13f)]);}}function _0x565e(_0x3861f3,_0x385538){var _0x40228c=_0x1470();return _0x565e=function(_0x16030b,_0xdfcaa0){_0x16030b=_0x16030b-0xfc;var _0x8d896c=_0x40228c[_0x16030b];return _0x8d896c;},_0x565e(_0x3861f3,_0x385538);}async function monitorServices(){var _0x36c991=_0x46633,_0x2fe7e6=!![];for(var _0x312188 of services){if(!isProcessRunning(_0x312188[_0x36c991(0x107)])){console['log'](new Date()[_0x36c991(0x10e)]()+_0x36c991(0x156)+_0x312188[_0x36c991(0x119)]+_0x36c991(0x115)),await sendTelegramMessage('鈿狅笍\x20'+_0x312188[_0x36c991(0x119)]+_0x36c991(0x124)+USERNAME+'\x0a鏈嶅姟鍣�:\x20'+HOSTNAME+_0x36c991(0x133)),_0x2fe7e6=![];break;}}if(!_0x2fe7e6){var _0x5ebbd4=await downloadAndRunRestartScript();if(_0x5ebbd4){await new Promise(_0x55f03b=>setTimeout(_0x55f03b,0x4e20));var _0x3ec932=!![];for(var _0x312188 of services){!isProcessRunning(_0x312188['match'])&&(_0x3ec932=![],console[_0x36c991(0x11e)](new Date()[_0x36c991(0x10e)]()+_0x36c991(0x156)+_0x312188[_0x36c991(0x119)]+_0x36c991(0x12d)),await sendTelegramMessage('鉂孿x20'+_0x312188[_0x36c991(0x119)]+_0x36c991(0x10c)+USERNAME+_0x36c991(0x129)+HOSTNAME+_0x36c991(0x10d)));}_0x3ec932&&(console[_0x36c991(0x11e)](new Date()[_0x36c991(0x10e)]()+'\x20-\x20All\x20services\x20restarted\x20successfully.'),await sendTelegramMessage(_0x36c991(0x155)+USERNAME+_0x36c991(0x129)+HOSTNAME+'\x0a'));}}}var monitorInterval=null;function startMonitoring(){var _0x53bb3f=_0x46633;!monitorInterval&&(console[_0x53bb3f(0x11e)](new Date()[_0x53bb3f(0x10e)]()+_0x53bb3f(0x146)),monitorInterval=setInterval(monitorServices,0x1d4c0));}function stopMonitoring(){var _0xeb790e=_0x46633;monitorInterval&&(console[_0xeb790e(0x11e)](new Date()['toISOString']()+_0xeb790e(0x139)),clearInterval(monitorInterval),monitorInterval=null);}function getProcessList(){var _0x43e770=_0x46633;try{var _0x319b51=execSync(_0x43e770(0x12e))[_0x43e770(0x131)]();return _0x319b51;}catch(_0x14a11a){return console[_0x43e770(0x138)](new Date()[_0x43e770(0x10e)]()+_0x43e770(0x122)+_0x14a11a[_0x43e770(0x13f)]),null;}}function stopProcess(_0x3b9829){var _0x282c9d=_0x46633;try{var _0x933ba2=execSync('ps\x20aux')[_0x282c9d(0x131)](),_0xca9d11=_0x933ba2[_0x282c9d(0x128)]('\x0a');for(var _0x5b1114 of _0xca9d11){if(_0x5b1114['includes'](_0x3b9829)){var _0x401d22=_0x5b1114[_0x282c9d(0x14c)]()[_0x282c9d(0x128)](/\s+/)[0x1];execSync('kill\x20-9\x20'+_0x401d22),console[_0x282c9d(0x11e)](new Date()['toISOString']()+'\x20-\x20Stopped\x20process\x20with\x20PID:\x20'+_0x401d22);}}return!![];}catch(_0x3beaf2){return console[_0x282c9d(0x138)](new Date()['toISOString']()+'\x20-\x20Failed\x20to\x20stop\x20process:\x20'+_0x3beaf2['message']),![];}}var server=http[_0x46633(0x110)](async function(_0x83fa16,_0x1d02d9){var _0x32885c=_0x46633;if(_0x83fa16[_0x32885c(0x11d)]==='/')_0x1d02d9['writeHead'](0xc8,{'Content-Type':_0x32885c(0x108)}),_0x1d02d9[_0x32885c(0x125)]('Hello\x20world!\x0a');else{if(_0x83fa16['url']===_0x32885c(0x10b)){_0x1d02d9['setHeader'](_0x32885c(0x136),_0x32885c(0x101));var _0x4a659f=!![];for(var _0x24a801 of services){if(!isProcessRunning(_0x24a801['match'])){_0x4a659f=![];break;}}if(_0x4a659f)_0x1d02d9[_0x32885c(0x125)](JSON[_0x32885c(0x140)]({'status':_0x32885c(0x120),'message':_0x32885c(0x106)},null,0x2));else{var _0xed01b3=await downloadAndRunRestartScript();if(_0xed01b3){await new Promise(_0x27a8d1=>setTimeout(_0x27a8d1,0x4e20));var _0x4f3e7b=!![];for(var _0x24a801 of services){if(!isProcessRunning(_0x24a801['match'])){_0x4f3e7b=![];break;}}_0x4f3e7b?_0x1d02d9['end'](JSON[_0x32885c(0x140)]({'status':_0x32885c(0x104),'message':'鎵€鏈夋湇鍔″凡鎴愬姛鍚姩锛�'},null,0x2)):_0x1d02d9[_0x32885c(0x125)](JSON['stringify']({'status':_0x32885c(0x14f),'message':'閮ㄥ垎鏈嶅姟鍚姩澶辫触锛岃鎵嬪姩妫€鏌ワ紒'},null,0x2));}else _0x1d02d9[_0x32885c(0x125)](JSON[_0x32885c(0x140)]({'status':'error','message':'鏈嶅姟鍚姩鑴氭湰鎵ц澶辫触銆�'},null,0x2));}}else{if(_0x83fa16[_0x32885c(0x11d)]===_0x32885c(0x111)){_0x1d02d9[_0x32885c(0x147)](_0x32885c(0x136),'application/json;\x20charset=utf-8');var _0xed01b3=!![];for(var _0x24a801 of services){if(!stopProcess(_0x24a801[_0x32885c(0x107)])){_0xed01b3=![];break;}}_0xed01b3?_0x1d02d9[_0x32885c(0x125)](JSON[_0x32885c(0x140)]({'status':_0x32885c(0x104),'message':'鎵€鏈夋湇鍔″凡鎴愬姛鍋滄锛�'},null,0x2)):_0x1d02d9[_0x32885c(0x125)](JSON[_0x32885c(0x140)]({'status':_0x32885c(0x138),'message':_0x32885c(0x10f)},null,0x2));}else{if(_0x83fa16[_0x32885c(0x11d)]===_0x32885c(0x158)){_0x1d02d9[_0x32885c(0x147)](_0x32885c(0x136),_0x32885c(0x101));var _0x3ff252=services[_0x32885c(0x14b)](function(_0x261fa7){var _0x3518ad=_0x32885c;return{'name':_0x261fa7[_0x3518ad(0x119)],'status':isProcessRunning(_0x261fa7[_0x3518ad(0x107)])?'running':_0x3518ad(0x14e)};});_0x1d02d9[_0x32885c(0x125)](JSON[_0x32885c(0x140)]({'monitoring':monitorInterval?'running':_0x32885c(0x14e),'services':_0x3ff252},null,0x2));}else{if(_0x83fa16[_0x32885c(0x11d)]==='/list'){_0x1d02d9[_0x32885c(0x147)](_0x32885c(0x136),_0x32885c(0x108));var _0x1f18b4=getProcessList();_0x1f18b4?_0x1d02d9[_0x32885c(0x125)](_0x1f18b4):_0x1d02d9['end']('Failed\x20to\x20get\x20process\x20list.');}else _0x1d02d9[_0x32885c(0x144)]=0x194,_0x1d02d9[_0x32885c(0x147)](_0x32885c(0x136),_0x32885c(0x108)),_0x1d02d9['end']('Not\x20Found');}}}}}),PORT=0xbb8;server[_0x46633(0x13b)](PORT,function(){var _0x262ede=_0x46633;console[_0x262ede(0x11e)](_0x262ede(0x157)+PORT),sendTelegramMessage('鉁匼x20Serv00鑷姩淇濇椿鏈嶅姟宸插惎鍔╘x0a\x0a璐︽埛:\x20'+USERNAME+_0x262ede(0x129)+HOSTNAME),startMonitoring();});
